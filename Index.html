<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mickey X Web - Multi-Platform Predictor</title>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyCShaI7FfDCvZ9t21RdBk7ATjk5PQUAeQI",
            authDomain: "wingo-predictor-hub.firebaseapp.com",
            databaseURL: "https://wingo-predictor-hub-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "wingo-predictor-hub",
            storageBucket: "wingo-predictor-hub.firebasestorage.app",
            messagingSenderId: "510934626240",
            appId: "1:510934626240:web:8df9c4b4a78964f15d2225",
            measurementId: "G-TTM7WXC4DW"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        window.firebaseDatabase = database;
        window.firebaseRef = ref;
        window.firebasePush = push;
        window.firebaseOnValue = onValue;
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Particles Background */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
        }

        /* Landing Page */
        #landing-page {
            display: block;
        }

        #prediction-page {
            display: none;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 30px 20px 20px;
            background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.7) 100%);
            border-bottom: 3px solid #ff3366;
            box-shadow: 0 5px 20px rgba(255, 51, 102, 0.3);
            position: relative;
        }

        .header h1 {
            font-size: 3rem;
            background: linear-gradient(90deg, #ff3366, #ff9966, #ff3366);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(255, 51, 102, 0.5);
            letter-spacing: 2px;
            font-weight: bold;
        }

        .header p {
            color: #ccc;
            font-size: 1.2rem;
            letter-spacing: 1px;
        }

        /* Online Users */
        .online-users {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(90deg, #00ff88, #00ccff);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
        }

        .online-users i {
            font-size: 1.2rem;
        }

        /* Platform Selection */
        .platform-section {
            padding: 30px 20px;
            text-align: center;
        }

        .platform-section h2 {
            font-size: 2.5rem;
            margin-bottom: 40px;
            color: #00ffcc;
            text-shadow: 0 0 15px rgba(0, 255, 204, 0.5);
            letter-spacing: 3px;
            background: linear-gradient(90deg, #00ffcc, #00ff88);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* Horizontal Scroll Container */
        .platform-container {
            display: flex;
            overflow-x: auto;
            gap: 25px;
            padding: 25px 20px;
            scroll-snap-type: x mandatory;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .platform-container::-webkit-scrollbar {
            display: none;
        }

        /* Phone-shaped Platform Boxes */
        .platform-box {
            flex: 0 0 auto;
            width: 300px;
            height: 550px;
            background: linear-gradient(145deg, #1e1e1e, #2a2a2a);
            border-radius: 40px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.4s ease;
            border: 3px solid #444;
            scroll-snap-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            padding: 20px;
            padding-top: 35px; /* Space for notch */
        }

        /* Phone notch */
        .platform-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 180px;
            height: 25px;
            background: #111;
            border-radius: 0 0 15px 15px;
            z-index: 2;
        }

        /* Phone speaker */
        .platform-box::after {
            content: '';
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 6px;
            background: #333;
            border-radius: 3px;
            z-index: 3;
        }

        .platform-box:hover {
            transform: translateY(-15px) scale(1.03);
            border-color: #ff3366;
            box-shadow: 0 20px 40px rgba(255, 51, 102, 0.4);
            background: linear-gradient(145deg, #2a2a2a, #333);
        }

        /* Platform Image Container - Full Screen Image */
        .platform-image-container {
            width: 100%;
            height: 400px;
            border-radius: 30px;
            overflow: hidden;
            position: relative;
            border: 2px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
        }

        .platform-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: all 0.3s ease;
        }

        .platform-box:hover .platform-image-container img {
            transform: scale(1.05);
            border-color: #ff3366;
            box-shadow: 0 0 30px rgba(255, 51, 102, 0.5);
        }

        .platform-box .platform-name {
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            background: linear-gradient(90deg, #fff, #ccc);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            padding: 10px 20px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Platform button */
        .select-btn {
            position: absolute;
            bottom: 20px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ff3366, #ff6699);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            color: white;
            box-shadow: 0 5px 15px rgba(255, 51, 102, 0.4);
            transition: all 0.3s ease;
            z-index: 2;
        }

        .platform-box:hover .select-btn {
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(255, 51, 102, 0.8);
        }

        /* Prediction Page - NEW DESIGN */
        .prediction-header {
            text-align: center;
            padding: 25px 20px;
            background: linear-gradient(180deg, rgba(10,10,10,0.95), rgba(20,20,20,0.9));
            border-bottom: 2px solid #333;
        }

        .prediction-header h1 {
            font-size: 2.8rem;
            background: linear-gradient(90deg, #fff, #aaa);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 15px;
            letter-spacing: 3px;
            font-weight: 800;
            text-transform: uppercase;
        }

        /* Server Status - New Design */
        .server-status-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .server-item {
            text-align: center;
        }

        .server-label {
            font-size: 1rem;
            color: #aaa;
            margin-bottom: 5px;
            letter-spacing: 1px;
        }

        .server-value {
            padding: 8px 20px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.1rem;
            letter-spacing: 1px;
            min-width: 180px;
        }

        .server-connected {
            background: #00ff88;
            color: #000;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .server-select {
            background: #ff3366;
            color: #fff;
            box-shadow: 0 0 10px rgba(255, 51, 102, 0.5);
        }

        /* Game Info - New Design */
        .game-info {
            text-align: center;
            padding: 25px;
            margin: 25px auto;
            background: rgba(30, 30, 30, 0.8);
            border-radius: 15px;
            border: 2px solid #333;
            max-width: 600px;
            backdrop-filter: blur(10px);
        }

        .period-display {
            font-size: 1.3rem;
            color: #00ccff;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .period-number {
            font-size: 2.2rem;
            font-weight: bold;
            color: #fff;
            letter-spacing: 3px;
            text-shadow: 0 0 10px rgba(0, 204, 255, 0.5);
        }

        /* Winning Proofs Section */
        .winning-proofs {
            padding: 25px;
            margin: 25px;
            background: linear-gradient(135deg, rgba(255, 140, 0, 0.15), rgba(255, 69, 0, 0.1));
            border-radius: 20px;
            border: 2px solid #ff8c00;
            box-shadow: 0 10px 30px rgba(255, 140, 0, 0.2);
        }

        .proofs-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 140, 0, 0.3);
        }

        .proofs-header h3 {
            color: #ff8c00;
            font-size: 1.8rem;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 140, 0, 0.5);
            letter-spacing: 2px;
        }

        .proofs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            max-height: 400px;
            overflow-y: auto;
            padding: 15px;
        }

        .proof-card {
            background: linear-gradient(145deg, rgba(255, 140, 0, 0.2), rgba(255, 69, 0, 0.15));
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #ff8c00;
            position: relative;
            overflow: hidden;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .proof-card::before {
            content: 'VERIFIED WIN';
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(90deg, #ff8c00, #ffa500);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .winner-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .winner-name {
            font-size: 1.3rem;
            color: #ffcc00;
            font-weight: bold;
        }

        .win-amount {
            font-size: 1.8rem;
            color: #00ff88;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .winner-info {
            margin-top: 10px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 0.9rem;
            color: #ccc;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-label {
            color: #aaa;
        }

        .info-value {
            color: #fff;
            font-weight: bold;
        }

        /* PREDICTION BOX - NEW DESIGN (Like LEGEND X WEB) */
        .prediction-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 300px;
            padding: 20px;
            margin: 20px auto;
            max-width: 800px;
        }

        .prediction-box-wrapper {
            width: 350px;
            background: rgba(40, 40, 40, 0.9);
            border-radius: 20px;
            border: 2px solid #444;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
        }

        .server-selection {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #444;
        }

        .server-type {
            font-size: 1.1rem;
            color: #aaa;
            letter-spacing: 1px;
        }

        .server-type-value {
            font-size: 1.2rem;
            color: #00ccff;
            font-weight: bold;
            text-transform: uppercase;
        }

        .prediction-content {
            text-align: center;
            padding: 20px 0;
        }

        .prediction-label {
            font-size: 1rem;
            color: #aaa;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .prediction-value {
            font-size: 4.5rem;
            font-weight: 800;
            letter-spacing: 3px;
            text-transform: uppercase;
            margin: 15px 0;
            text-shadow: 0 0 20px currentColor;
        }

        .prediction-green {
            color: #00ff88;
        }

        .prediction-red {
            color: #ff3366;
        }

        .prediction-big {
            color: #ffcc00;
        }

        .prediction-small {
            color: #00ccff;
        }

        /* Server Select Section */
        .server-select-section {
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid #444;
            text-align: center;
        }

        .server-select-label {
            font-size: 1rem;
            color: #aaa;
            margin-bottom: 10px;
        }

        .server-select-value {
            font-size: 1.3rem;
            color: #ff3366;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Back Button */
        .back-btn {
            position: fixed;
            bottom: 25px;
            left: 25px;
            background: linear-gradient(90deg, #ff3366, #ff6699);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1rem;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(255, 51, 102, 0.4);
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(255, 51, 102, 0.6);
        }

        /* Loading State */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .prediction-status {
            text-align: center;
            color: #aaa;
            font-size: 0.9rem;
            margin-top: 10px;
            min-height: 20px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .platform-box {
                width: 280px;
                height: 500px;
            }
            
            .platform-image-container {
                height: 350px;
            }
            
            .prediction-value {
                font-size: 3.5rem;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .proofs-grid {
                grid-template-columns: 1fr;
            }
            
            .server-value {
                min-width: 150px;
                padding: 8px 15px;
                font-size: 1rem;
            }
            
            .online-users {
                position: relative;
                top: 0;
                right: 0;
                margin: 10px auto;
                width: fit-content;
            }
            
            .prediction-box-wrapper {
                width: 90%;
                padding: 20px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Particles Background -->
    <div id="particles-js"></div>

    <!-- Landing Page -->
    <div id="landing-page">
        <div class="header">
            <h1>MICKEY X WEB</h1>
            <p>Choose Your Prediction Platform</p>
            <div class="online-users">
                <i class="fas fa-users"></i> ONLINE: 999+
            </div>
        </div>

        <div class="platform-section">
            <h2>SELECT PLATFORM</h2>
            <div class="platform-container">
                <!-- 91 Club Platform -->
                <div class="platform-box" onclick="selectPlatform('91 CLUB')">
                    <div class="platform-image-container">
                        <img src="91club.png" alt="91Club" onerror="this.onerror=null; this.src='https://via.placeholder.com/300x400/ff3366/000000?text=91CLUB'">
                    </div>
                    <div class="platform-name">91 Club</div>
                    <div class="select-btn">
                        <i class="fas fa-play"></i>
                    </div>
                </div>

                <!-- Tashan Platform -->
                <div class="platform-box" onclick="selectPlatform('TASHAN WIN')">
                    <div class="platform-image-container">
                        <img src="tashan.png" alt="Tashan" onerror="this.onerror=null; this.src='https://via.placeholder.com/300x400/00ccff/000000?text=TASHAN'">
                    </div>
                    <div class="platform-name">Tashan Win</div>
                    <div class="select-btn">
                        <i class="fas fa-play"></i>
                    </div>
                </div>

                <!-- 82 Lottery Platform -->
                <div class="platform-box" onclick="selectPlatform('82 LOTTERY')">
                    <div class="platform-image-container">
                        <img src="82lottery.png" alt="82Lottery" onerror="this.onerror=null; this.src='https://via.placeholder.com/300x400/ffcc00/000000?text=82LOTTO'">
                    </div>
                    <div class="platform-name">82 Lottery</div>
                    <div class="select-btn">
                        <i class="fas fa-play"></i>
                    </div>
                </div>

                <!-- Goa Game Platform -->
                <div class="platform-box" onclick="selectPlatform('GOA GAME')">
                    <div class="platform-image-container">
                        <img src="goagame.png" alt="GoaGame" onerror="this.onerror=null; this.src='https://via.placeholder.com/300x400/00ff88/000000?text=GOAGAME'">
                    </div>
                    <div class="platform-name">Goa Game</div>
                    <div class="select-btn">
                        <i class="fas fa-play"></i>
                    </div>
                </div>

                <!-- Daman Platform -->
                <div class="platform-box" onclick="selectPlatform('DAMAN GAME')">
                    <div class="platform-image-container">
                        <img src="daman.png" alt="Daman" onerror="this.onerror=null; this.src='https://via.placeholder.com/300x400/ff00ff/000000?text=DAMAN'">
                    </div>
                    <div class="platform-name">Daman Game</div>
                    <div class="select-btn">
                        <i class="fas fa-play"></i>
                    </div>
                </div>

                <!-- BDG Game Platform -->
                <div class="platform-box" onclick="selectPlatform('BDG GAME')">
                    <div class="platform-image-container">
                        <img src="bdggame.png" alt="BDGGame" onerror="this.onerror=null; this.src='https://via.placeholder.com/300x400/ff3366/000000?text=BDGGAME'">
                    </div>
                    <div class="platform-name">BDG Game</div>
                    <div class="select-btn">
                        <i class="fas fa-play"></i>
                    </div>
                </div>

                <!-- Jalwa Platform -->
                <div class="platform-box" onclick="selectPlatform('JALWA GAME')">
                    <div class="platform-image-container">
                        <img src="jalwa.png" alt="Jalwa" onerror="this.onerror=null; this.src='https://via.placeholder.com/300x400/00ccff/000000?text=JALWA'">
                    </div>
                    <div class="platform-name">Jalwa Game</div>
                    <div class="select-btn">
                        <i class="fas fa-play"></i>
                    </div>
                </div>

                <!-- DM Win Platform -->
                <div class="platform-box" onclick="selectPlatform('DM WIN')">
                    <div class="platform-image-container">
                        <img src="dmwin.png" alt="DMWin" onerror="this.onerror=null; this.src='https://via.placeholder.com/300x400/ffcc00/000000?text=DMWIN'">
                    </div>
                    <div class="platform-name">DM Win</div>
                    <div class="select-btn">
                        <i class="fas fa-play"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Prediction Page -->
    <div id="prediction-page">
        <div class="prediction-header">
            <h1>MICKEY X WEB</h1>
            <div class="online-users">
                <i class="fas fa-users"></i> ONLINE: 999+
            </div>
            
            <div class="server-status-container">
                <div class="server-item">
                    <div class="server-label">SERVER 1</div>
                    <div class="server-value server-connected" id="server1">CONNECTED</div>
                </div>
                <div class="server-item">
                    <div class="server-label">SERVER SELECT</div>
                    <div class="server-value server-select" id="server2">RED/GREEN</div>
                </div>
            </div>
        </div>

        <!-- Winning Proofs Section -->
        <div class="winning-proofs">
            <div class="proofs-header">
                <h3><i class="fas fa-trophy"></i> WINNING PROOFS - VERIFIED RESULTS ‚ù§Ô∏è <i class="fas fa-trophy"></i></h3>
                <p style="color: #aaa; margin-top: 10px;">Live winning proofs from our users</p>
            </div>
            <div class="proofs-grid" id="proofsList">
                <!-- Proofs will be loaded from Firebase and auto-generated -->
            </div>
        </div>

        <div class="game-info">
            <div class="period-display">NEXT GAME PERIOD :</div>
            <div class="period-number" id="periodNumber">20250125100051349</div>
            <div class="prediction-status" id="predictionStatus">Waiting for next period...</div>
        </div>

        <!-- PREDICTION BOX - NEW DESIGN -->
        <div class="prediction-container">
            <div class="prediction-box-wrapper">
                <div class="server-selection">
                    <div class="server-type">SERVER TYPE</div>
                    <div class="server-type-value" id="serverTypeLabel">COLOR SERVER</div>
                </div>
                
                <div class="prediction-content">
                    <div class="prediction-label">PREDICTION</div>
                    <div class="prediction-value" id="predictionText">GREEN</div>
                </div>
                
                <div class="server-select-section">
                    <div class="server-select-label">SERVER SELECT</div>
                    <div class="server-select-value" id="serverSelectValue">RED/GREEN</div>
                </div>
            </div>
        </div>

        <button class="back-btn" onclick="goBack()">
            <i class="fas fa-arrow-left"></i> BACK TO PLATFORMS
        </button>
    </div>

    <!-- Audio Elements -->
    <audio id="winSound" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>
    <audio id="loseSound" src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3"></audio>

    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script>
        // Particles Background
        particlesJS('particles-js', {
            particles: {
                number: { value: 80, density: { enable: true, value_area: 800 } },
                color: { value: ["#ff3366", "#00ff88", "#00ccff", "#ffcc00"] },
                shape: { type: "circle" },
                opacity: { value: 0.6, random: true },
                size: { value: 3, random: true },
                line_linked: {
                    enable: true,
                    distance: 150,
                    color: "#444",
                    opacity: 0.4,
                    width: 1
                },
                move: {
                    enable: true,
                    speed: 2,
                    direction: "none",
                    random: true,
                    straight: false,
                    out_mode: "out",
                    bounce: false
                }
            },
            interactivity: {
                detect_on: "canvas",
                events: {
                    onhover: { enable: true, mode: "repulse" },
                    onclick: { enable: true, mode: "push" }
                }
            }
        });

        // Global Variables - FIXED
        let currentServer = 'color';
        let lastPrediction = null;
        let currentPeriod = '';
        let nextPeriod = '';
        let lastResult = '';
        let apiUrl = "https://draw.ar-lottery01.com/WinGo/WinGo_1M/GetHistoryIssuePage.json";
        let proofInterval = null;
        let currentPlatform = '';
        let lastProcessedPeriod = ''; // Track the last period we processed
        let predictionMadeForPeriod = ''; // Track which period we made prediction for
        let isWaitingForResult = false; // Track if we're waiting for result
        let fetchInterval = null;

        // Indian Names List
        const indianNames = [
            "Rajesh Kumar", "Priya Sharma", "Amit Patel", "Sneha Singh", "Rohit Verma", 
            "Anjali Gupta", "Vikram Yadav", "Pooja Mishra", "Sanjay Tiwari", "Neha Joshi",
            "Arun Deshmukh", "Swati Reddy", "Manoj Choudhary", "Kavita Nair", "Deepak Iyer",
            "Sunita Menon", "Ramesh Pillai", "Lakshmi Rao", "Suresh Bansal", "Meena Chatterjee",
            "Kiran Mehta", "Divya Saxena", "Harshad Shah", "Ritu Agarwal", "Nitin Kapoor",
            "Shalini Malhotra", "Prakash Sinha", "Geeta Biswas", "Vivek Trivedi", "Anita Dutta"
        ];

        // Platform List
        const platforms = [
            "91 CLUB", "TASHAN WIN", "82 LOTTERY", "GOA GAME", 
            "DAMAN GAME", "BDG GAME", "JALWA GAME", "DM WIN"
        ];

        // Platform Selection
        function selectPlatform(platform) {
            document.getElementById('landing-page').style.display = 'none';
            document.getElementById('prediction-page').style.display = 'block';
            
            currentPlatform = platform;
            document.getElementById('server2').textContent = platform;
            
            // Reset tracking variables
            lastProcessedPeriod = '';
            predictionMadeForPeriod = '';
            isWaitingForResult = false;
            
            startPredictionSystem();
        }

        // Back to platforms
        function goBack() {
            document.getElementById('prediction-page').style.display = 'none';
            document.getElementById('landing-page').style.display = 'block';
            
            // Clear all intervals
            if (proofInterval) {
                clearInterval(proofInterval);
                proofInterval = null;
            }
            if (fetchInterval) {
                clearInterval(fetchInterval);
                fetchInterval = null;
            }
            
            // Reset variables
            lastProcessedPeriod = '';
            predictionMadeForPeriod = '';
            isWaitingForResult = false;
        }

        // Random server selection
        function getRandomServer() {
            const switchCount = Math.floor(Math.random() * 5) + 1;
            for (let i = 0; i < switchCount; i++) {
                currentServer = currentServer === 'color' ? 'size' : 'color';
            }
            
            // Update server type label
            const serverTypeLabel = document.getElementById('serverTypeLabel');
            const serverSelectValue = document.getElementById('serverSelectValue');
            
            if (currentServer === 'color') {
                serverTypeLabel.textContent = 'COLOR SERVER';
                serverSelectValue.textContent = 'RED/GREEN';
            } else {
                serverTypeLabel.textContent = 'SIZE SERVER';
                serverSelectValue.textContent = 'BIG/SMALL';
            }
            
            return currentServer;
        }

        // Pattern analysis
        function getType(num) {
            return num >= 5 ? "B" : "S";
        }

        // Pattern maps
        const trendMap7 = {
            'BBBBBBB': 'S',
            'SSSSSSS': 'B',
            'BBBBBBS': 'S',
            'SSSSSSB': 'B',
            'BBBBSSB': 'S',
            'SSSSBSS': 'B',
            'BBBSBBB': 'S',
            'BBSBBBB': 'S',
            'BSBBBBB': 'B',
            'SSBBSSB': 'B',
            'SBSSBBS': 'B',
            'SSBBSBS': 'B',
            'BBSBSBS': 'B',
            'SBSBSBS': 'B',
            'BSSBSSB': 'S',
            'SSBBSSS': 'S',
            'BSSSSSS': 'S',
            'SSBBBSS': 'B',
            'BSSBBBS': 'S',
            'SSBSSBB': 'B'
        };

        const trendMap6 = {
            'BBBBBB': 'B',
            'SSSSSS': 'S',
            'BBBSSB': 'S',
            'SSBBSS': 'B',
            'BBSBSB': 'B',
            'SBBSBB': 'S',
            'BSBSBS': 'S',
            'SBSBSB': 'B',
            'BBSSBB': 'S',
            'SSBBSS': 'B',
            'BSSBSS': 'S',
            'SBBSSB': 'B',
            'BBSBBS': 'B',
            'SBBSBB': 'S',
            'BSSBBBB': 'S',
            'SSSBBBS': 'B',
            'BBBSSSB': 'S',
            'SBBBSSB': 'B'
        };

        const trendMap5 = {
            'BBSBB': 'S',
            'SSBSS': 'B',
            'BSBBS': 'S',
            'SBSBB': 'B',
            'BBBSS': 'S',
            'SSSBB': 'B',
            'SBSSC': 'B',
            'BSSSB': 'S',
            'SBBSB': 'B',
            'SSBSS': 'S'
        };

        // Get prediction based on pattern
        function getPrediction(history) {
            const seq7 = history.slice(0, 7).join('');
            const seq6 = history.slice(0, 6).join('');
            const seq5 = history.slice(0, 5).join('');
            
            if (trendMap7[seq7]) return { prediction: trendMap7[seq7], confidence: 90, pattern: `7D: ${seq7}` };
            if (trendMap6[seq6]) return { prediction: trendMap6[seq6], confidence: 80, pattern: `6D: ${seq6}` };
            if (trendMap5[seq5]) return { prediction: trendMap5[seq5], confidence: 70, pattern: `5D: ${seq5}` };
            
            return { prediction: Math.random() > 0.5 ? 'B' : 'S', confidence: 50, pattern: 'RANDOM' };
        }

        // Calculate next period number
        function calculateNextPeriod(currentPeriod) {
            if (!currentPeriod) return '';
            
            const periodStr = currentPeriod.toString();
            const lastPart = periodStr.slice(-5);
            const prefix = periodStr.slice(0, -5);
            
            const nextNum = (parseInt(lastPart) + 1).toString().padStart(5, '0');
            return prefix + nextNum;
        }

        // Generate random winning proof
        function generateRandomWinningProof() {
            const randomName = indianNames[Math.floor(Math.random() * indianNames.length)];
            const randomPlatform = platforms[Math.floor(Math.random() * platforms.length)];
            const randomAmount = Math.floor(Math.random() * (100000 - 200 + 1)) + 200;
            const randomAccount = "****" + Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            
            let randomPeriod;
            if (currentPeriod) {
                const periodNum = parseInt(currentPeriod.slice(-5));
                const randomOffset = Math.floor(Math.random() * 100) - 50;
                randomPeriod = currentPeriod.slice(0, -5) + (periodNum + randomOffset).toString().padStart(5, '0');
            } else {
                randomPeriod = "20250125" + Math.floor(Math.random() * 100000).toString().padStart(5, '0');
            }
            
            return {
                name: randomName,
                platform: randomPlatform,
                winAmount: randomAmount,
                account: randomAccount,
                period: randomPeriod,
                timestamp: Date.now()
            };
        }

        // Add winning proof to display
        function addWinningProofToDisplay(proof) {
            const proofsList = document.getElementById('proofsList');
            
            const proofItem = document.createElement('div');
            proofItem.className = 'proof-card';
            proofItem.innerHTML = `
                <div class="winner-header">
                    <div class="winner-name">${proof.name}</div>
                    <div class="win-amount">‚Çπ ${proof.winAmount.toLocaleString()}</div>
                </div>
                <div class="winner-info">
                    <div class="info-row">
                        <span class="info-label">Account:</span>
                        <span class="info-value">${proof.account}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Period:</span>
                        <span class="info-value">${proof.period}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Platform:</span>
                        <span class="info-value">${proof.platform}</span>
                    </div>
                </div>
            `;
            
            proofsList.insertBefore(proofItem, proofsList.firstChild);
            
            if (proofsList.children.length > 12) {
                proofsList.removeChild(proofsList.lastChild);
            }
            
            addProofToFirebase(proof);
        }

        // Add proof to Firebase
        async function addProofToFirebase(proof) {
            try {
                if (window.firebaseDatabase) {
                    const proofsRef = window.firebaseRef(window.firebaseDatabase, 'winningProofs');
                    await window.firebasePush(proofsRef, proof);
                }
            } catch (error) {
                console.error('Error adding to Firebase:', error);
            }
        }

        // Load winning proofs from Firebase
        function loadWinningProofs() {
            try {
                if (!window.firebaseDatabase) return;
                
                const proofsRef = window.firebaseRef(window.firebaseDatabase, 'winningProofs');
                window.firebaseOnValue(proofsRef, (snapshot) => {
                    const data = snapshot.val();
                    const proofsList = document.getElementById('proofsList');
                    
                    if (data) {
                        proofsList.innerHTML = '';
                        const proofs = Object.values(data);
                        
                        proofs.sort((a, b) => b.timestamp - a.timestamp)
                             .slice(0, 6)
                             .forEach(proof => {
                                 const proofItem = document.createElement('div');
                                 proofItem.className = 'proof-card';
                                 proofItem.innerHTML = `
                                     <div class="winner-header">
                                         <div class="winner-name">${proof.name}</div>
                                         <div class="win-amount">‚Çπ ${proof.winAmount?.toLocaleString() || '17,000'}</div>
                                     </div>
                                     <div class="winner-info">
                                         <div class="info-row">
                                             <span class="info-label">Account:</span>
                                             <span class="info-value">${proof.account || '****7890'}</span>
                                         </div>
                                         <div class="info-row">
                                             <span class="info-label">Period:</span>
                                             <span class="info-value">${proof.period || '20250125100051346'}</span>
                                         </div>
                                         <div class="info-row">
                                             <span class="info-label">Platform:</span>
                                             <span class="info-value">${proof.platform || 'TASHAN WIN'}</span>
                                         </div>
                                     </div>
                                 `;
                                 proofsList.appendChild(proofItem);
                             });
                    } else {
                        showSampleProofs();
                    }
                });
            } catch (error) {
                console.error('Error loading proofs:', error);
                showSampleProofs();
            }
        }

        // Show sample proofs
        function showSampleProofs() {
            const proofsList = document.getElementById('proofsList');
            proofsList.innerHTML = '';
            
            const sampleProofs = [
                { name: "Sanjay Tiwari", winAmount: 99701, account: "****0288", period: "20260114100010684", platform: "TASHAN WIN" },
                { name: "Lakshmi Rao", winAmount: 99700, account: "****3793", period: "20260114100010704", platform: "JALWA GAME" },
                { name: "Rajesh Kumar", winAmount: 85600, account: "****4567", period: "20260114100010692", platform: "91 CLUB" }
            ];
            
            sampleProofs.forEach(proof => {
                const proofItem = document.createElement('div');
                proofItem.className = 'proof-card';
                proofItem.innerHTML = `
                    <div class="winner-header">
                        <div class="winner-name">${proof.name}</div>
                        <div class="win-amount">‚Çπ ${proof.winAmount.toLocaleString()}</div>
                    </div>
                    <div class="winner-info">
                        <div class="info-row">
                            <span class="info-label">Account:</span>
                            <span class="info-value">${proof.account}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Period:</span>
                            <span class="info-value">${proof.period}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Platform:</span>
                            <span class="info-value">${proof.platform}</span>
                        </div>
                    </div>
                `;
                proofsList.appendChild(proofItem);
            });
        }

        // Fetch data from API - FIXED VERSION
        async function fetchData() {
            try {
                const response = await fetch(apiUrl);
                const data = await response.json();
                
                if (data.data && data.data.list && data.data.list.length > 0) {
                    const latest = data.data.list[0];
                    currentPeriod = latest.issueNumber;
                    lastResult = parseInt(latest.number);
                    
                    // Update status
                    document.getElementById('predictionStatus').textContent = `Current Period: ${currentPeriod}`;
                    
                    // Check if this is a new period we haven't processed yet
                    if (currentPeriod !== lastProcessedPeriod) {
                        // New period detected!
                        lastProcessedPeriod = currentPeriod;
                        
                        // Calculate next period
                        nextPeriod = calculateNextPeriod(currentPeriod);
                        
                        // Update period display (show NEXT period)
                        document.getElementById('periodNumber').textContent = nextPeriod;
                        
                        // Get history for pattern analysis
                        const history = data.data.list.slice(0, 50).map(item => getType(parseInt(item.number)));
                        
                        // Get prediction
                        const server = getRandomServer();
                        const pred = getPrediction(history);
                        
                        let displayText = '';
                        let cssClass = '';
                        
                        if (server === 'color') {
                            displayText = pred.prediction === 'B' ? 'RED' : 'GREEN';
                            cssClass = pred.prediction === 'B' ? 'prediction-red' : 'prediction-green';
                        } else {
                            displayText = pred.prediction === 'B' ? 'BIG' : 'SMALL';
                            cssClass = pred.prediction === 'B' ? 'prediction-big' : 'prediction-small';
                        }
                        
                        // Update prediction display
                        const predictionText = document.getElementById('predictionText');
                        predictionText.textContent = displayText;
                        predictionText.className = 'prediction-value ' + cssClass;
                        
                        // Store the prediction for this period
                        predictionMadeForPeriod = nextPeriod;
                        lastPrediction = {
                            server: server,
                            prediction: pred.prediction,
                            display: displayText,
                            period: currentPeriod,
                            nextPeriod: nextPeriod
                        };
                        
                        // Set flag that we're waiting for result
                        isWaitingForResult = true;
                        
                        // Update status
                        document.getElementById('predictionStatus').textContent = `Prediction made for period: ${nextPeriod}`;
                        
                        console.log(`New prediction made for period: ${nextPeriod} - ${displayText}`);
                    }
                    
                    // Check if we have a pending prediction and its result is available
                    if (isWaitingForResult && predictionMadeForPeriod === currentPeriod) {
                        // The period we predicted for has now arrived with result
                        checkResult();
                        isWaitingForResult = false;
                    }
                    
                }
            } catch (error) {
                console.error('Error fetching data:', error);
                // Don't generate random prediction - just show error
                document.getElementById('predictionStatus').textContent = "Error fetching data. Retrying...";
            }
        }

        // Check result against prediction
        function checkResult() {
            if (!lastPrediction || !lastResult) return;
            
            const actualType = getType(lastResult);
            let isWin = false;
            
            if (lastPrediction.server === 'color') {
                isWin = (lastPrediction.prediction === 'B' && actualType === 'B') || 
                        (lastPrediction.prediction === 'S' && actualType === 'S');
            } else {
                isWin = (lastPrediction.prediction === 'B' && actualType === 'B') || 
                        (lastPrediction.prediction === 'S' && actualType === 'S');
            }
            
            const winSound = document.getElementById('winSound');
            const loseSound = document.getElementById('loseSound');
            
            if (isWin) {
                winSound.currentTime = 0;
                winSound.play();
                
                // Generate winning proof for this win
                const winProof = {
                    name: indianNames[Math.floor(Math.random() * indianNames.length)],
                    platform: currentPlatform,
                    winAmount: Math.floor(Math.random() * (100000 - 200 + 1)) + 200,
                    account: "****" + Math.floor(Math.random() * 10000).toString().padStart(4, '0'),
                    period: currentPeriod,
                    timestamp: Date.now()
                };
                
                addWinningProofToDisplay(winProof);
                
                // Update status
                document.getElementById('predictionStatus').textContent = `üéâ WIN! Prediction was correct for period: ${currentPeriod}`;
            } else {
                loseSound.currentTime = 0;
                loseSound.play();
                document.getElementById('predictionStatus').textContent = `‚ùå LOSS! Prediction was wrong for period: ${currentPeriod}`;
            }
            
            console.log(`Result checked for period ${currentPeriod}: ${isWin ? 'WIN' : 'LOSS'}`);
        }

        // Start prediction system
        function startPredictionSystem() {
            // Initial fetch
            fetchData();
            
            // Fetch every 5 seconds
            fetchInterval = setInterval(fetchData, 5000);
            
            // Load initial winning proofs
            loadWinningProofs();
            
            // Start auto-generating winning proofs every 2 seconds
            if (proofInterval) {
                clearInterval(proofInterval);
            }
            
            proofInterval = setInterval(() => {
                const randomProof = generateRandomWinningProof();
                addWinningProofToDisplay(randomProof);
            }, 2000);
        }
    </script>
</body>
</html>
